
import json
import nmap
# download nmap
def port_scan(param):
     host = param['ip']
     nm = nmap.PortScanner()
     param['state'] = 'scanning'
     try:
         nm.scan(host)
         ports = nm[host]['tcp'].keys()
         report_list = []
         for port in ports:
             report = {}
             state = nm[host]['tcp'][port]['state']
             service = nm[host]['tcp'][port]['name']
             report['port'] = port
             report['state'] = state
             report['service'] = service
             if state == 'open':
                 report_list.append(report)
         print (report_list)
         param['state'] = 'scanned'
         param['report'] = json.dumps(report_list)
         return json.dumps(report_list)
     except Exception as e:
         print (e)

param = json.loads ('{"ip":"127.0.0.1"}')
port_scan (param)
